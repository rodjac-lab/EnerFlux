# EnerFlux — Development Plan

## Overview
EnerFlux v1 vise à offrir un simulateur complet d'autoconsommation résidentielle, couvrant la planification énergétique (PV, batterie, ECS, chauffage, piscine, VE), les comparaisons de stratégies A/B et un ensemble de KPIs physiques/économiques exploitables. L'objectif produit est d'apporter une UI fluide, des scénarios reproductibles et des décisions appuyées par des métriques unit-safe et documentées.

## Lots S1 → S6
| Lot | Scope & goals | Changes | Deliverables | Acceptance criteria | Risks / Mitigations | Links | Owner |
| --- | --- | --- | --- | --- | --- | --- | --- |
| **S1 — Core foundations** | Boucle moteur, ECS, batterie, UI minimale.<br>Aligner la physique (bilans kW/kWh) et les presets de base. | Implémenter `core/engine`, stratégies ECS/batterie, presets été/hiver basiques. | Modules `core/engine.ts`, `core/strategy.ts`, `core/kpis.ts`.<br>Devices `Battery`, `DHWTank`.<br>UI App A/B + 2 graphes. | • KPI énergie respectent bilans à 1e-6 kWh.<br>• ECS atteint consigne + secours si besoin.<br>• Tests `engine_minimal` & `ecs_physics` verts. | Sous-modélisation ECS → valider via cas extrêmes.<br>Perf UI → pré-rendu + worker.<br>Dette technique → checklist JSDoc. | [Docs/status.md](Docs/status.md#dernieres-etapes)<br>[Docs/todo.md](Docs/todo.md#court-terme-s3) | Core team |
| **S2 — UX & multi-métriques** | Clarifier la comparaison A/B et les scores multi-critères. | Vue KPI condensée, presets enrichis, stratégie `mix_soc_threshold`. | UI comparateur enrichi, exports CSV/JSON v1, doc KPIs. | • Score multi-métriques affiché en UI.<br>• Export JSON validé (schéma v1).<br>• Tests snapshot KPI stables. | Complexité UI → prototypes Figma.<br>Désalignement produit → revue hebdo.<br>Export volumineux → streaming worker. | [Docs/status.md](Docs/status.md#dernieres-etapes)<br>[Docs/todo.md](Docs/todo.md#moyen-terme-s4) | UX guild |
| **S3 — ECS service contract** | Introduire contrats ECS & helpers pour gérer confort. | Contrat service ECS, stratégies `ecs_hysteresis` & `deadline_helper`, presets dédiés. | Types `EcsServiceContract`, panneau UI ECS, docs README. | • Penalties € appliquées si cible manquée.<br>• KPI T° ECS ≥ cible >95 % sur preset « Matin froid ».<br>• Tests `ecs_service_contract` et `ecs_helpers` verts. | Compréhension contrat → doc & tooltips.<br>Régression ECS → tests golden flux ECS.<br>Charge cognitive UI → toggles contextualisés. | [Docs/todo.md](Docs/todo.md#court-terme-s3) | ECS squad |
| **S4 — Économie & stratégie soirée** | Ajouter KPIs économiques et arbitrage soirée. | Stratégie `reserve_evening`, KPIs ROI/Δ€, vue KPI condensée. | Modules KPI € + docs, presets soirée. | • KPI ROI et Δ€ affichés et documentés.<br>• Stratégie `reserve_evening` maintient SOC ≥60 % avant 18 h dans tests.<br>• Snapshot KPI € stable sur preset « Ballon confort ». | Hypothèses € fragiles → référence `Docs/metrics_and_tests.md`.<br>Stratégie mal comprise → guide scenario. | [Docs/status.md](Docs/status.md#dernieres-etapes)<br>[Docs/todo.md](Docs/todo.md#moyen-terme-s4) | Finance WG |
| **S5 — Multi-équipements** | Intégrer chauffage, piscine, VE et arbitrage multi-priorités. | Implémenter devices chauffage/piscine/VE, stratégie `multi_equipment_priority`, KPIs confort. | Devices S5, presets hiver/piscine/VE, capture comparateur, tests physiques. | • Chauffage maintient confort ≥90 % sur preset hiver.<br>• Filtration piscine ≥100 % complétée sur preset été.<br>• KPIs confort affichés et validés via tests Vitest. | Synchronisation équipes → stand-up dédié.<br>Complexité stratégie → pseudo-code partagé (`Docs/s5_plan.md`).<br>Dette doc → suivi `Docs/status.md`. | [Docs/s5_plan.md](Docs/s5_plan.md)<br>[Docs/status.md](Docs/status.md#prochain-focus-s5) | Multi-eq taskforce |
| **S6 — Tarifs avancés & ouverture** | Préparer V1 publique : tarifs dynamiques, API export, monitoring. | Ajout ToU dynamique, scénarios multi-jours, API REST d'export, instrumentation Sentry. | Modules tarifs dynamiques, scheduler multi-jours, documentation API, bundle monitoré. | • Simulation multi-jours validée (scénario semaine).<br>• API export retourne JSON signé (tests contract).<br>• Alerting Sentry actif en préprod. | Scope creep → RFC obligatoire.<br>Perf multi-jours → profiling & caching.<br>Risques compliance → revue légale. | [Docs/todo.md](Docs/todo.md#long-terme)<br>[Docs/status.md](Docs/status.md#etat-deploiement) | Core + Platform |

## Current Focus — S5 Synthesis
Le lot actif est **S5**. Les détails opérationnels (découpage, pseudo-code stratégie, KPIs confort) sont centralisés dans [Docs/s5_plan.md](Docs/s5_plan.md). Le suivi quotidien (ticks backlog, décisions) reste dans [Docs/status.md](Docs/status.md) et [Docs/todo.md](Docs/todo.md). Cette page sert de synthèse pour prioriser les chantiers et pointer vers les artefacts vivants.

## Governance
- **Proposer un lot** : ouvrir une RFC courte (PR `Docs/development_plan.md`) décrivant objectifs, owner, risques. Validation lors du weekly planning.
- **Valider / fermer un lot** :
  - Vérifier que les critères d’acceptation sont démontrés (tests, captures, exports) et référencés dans `Docs/status.md`.
  - Mettre à jour `Docs/todo.md` (case cochée) et ajouter un résumé de livraison dans `Docs/status.md`.
  - Fermer ou lier les issues/PRs associées.
- **Déplacer un item** : noter le changement dans `Docs/status.md` (section « Décisions produit ») et ajuster `Docs/todo.md` en conséquence, en gardant l’historique (cases décochées → commentaires).


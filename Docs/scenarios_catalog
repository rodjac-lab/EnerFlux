# Scenarios Catalog — EnerFlux

## Cas canoniques (S1)

### 1) Été ensoleillé — présence journée
- dt = 900 s (15 min), durée = 1 jour
- PV sinusoïdal, pic 4 kW (8h–18h)
- Load_base : 0.4 kW journée, 0.6 kW soir
- Batterie 10 kWh, P_max 3 kW
- ECS 300 L, P_res 2 kW, T0=15 °C, T_cible=55 °C

**Attendus** :
- `ecs_first` : ECS chauffe tôt, moins d’export
- `battery_first` : SOC monte tôt, ECS chauffe plus tard

### 2) Hiver couvert — présence soirée
- PV faible, pics 0.8 kW
- Load_base plus élevé le soir (1.2 kW)
- ECS pertes plus grandes (T_amb = 15 °C)

### 3) Matin froid — contrat ECS prioritaire
- dt = 900 s (15 min), durée = 1 jour
- PV tardif, pic 3.2 kW (8h–18h)
- Load_base : 0.35 kW journée, 1.1 kW soirée avec coup de feu 6h–9h
- Batterie bridée : 10 kWh, P_max 1 kW (service ECS prioritaire)
- ECS 300 L, P_res 2.6 kW, T0 = 15 °C, T_cible = 55 °C
- Tarifs ToU : pointe 6h–9h et 19h–21h

**Attendus** :
- `ecs_hysteresis` limite les cycles courts une fois la cible atteinte.
- `deadline_helper` déclenche juste avant la pointe matin pour réduire le secours réseau.

### 4) Ballon confort — soirée (ToU renforcé)
- dt = 900 s (15 min), durée = 1 jour
- PV régulier, pic 4.2 kW (7h–19h, atténuation légère)
- Load_base : 0.5 kW journée, 1.25 kW soirée
- Batterie 12 kWh, P_max 3.2 kW (garde une réserve pour le soir)
- ECS 270 L, P_res 2.8 kW, T0 = 48 °C, T_cible = 58 °C
- Tarifs ToU : pointe 7h–9h et 18h–22h (0.32 €/kWh)

**Attendus** :
- `deadline_helper` préchauffe avant 18h pour limiter la pointe.
- Comparer `battery_first` vs `ecs_first` pour arbitrer confort vs cycles batterie.
- `reserve_evening` doit constituer une réserve ≥60 % de SOC avant la pointe du soir puis alimenter l’ECS dès que possible.

### 5) Batterie quasi vide — stress stratégie batterie
- dt = 900 s (15 min), durée = 1 jour
- PV sinusoïdal, pic 3.8 kW (8h–18h)
- Load_base : 0.8 kW nuit/soir, décroissance douce 6h–8h avec surcroît matinal
- Batterie 10 kWh, SOC initial 0.5 kWh, P_max 2 kW
- ECS 300 L, P_res 3 kW, T0 = 35 °C, T_cible = 55 °C

**Attendus** :
- `ecs_first` consomme le peu de PV matinal pour l'ECS ⇒ batterie reste vide avant midi
- `battery_first` capte rapidement le pic PV ⇒ SOC remonte avant l'après-midi, autoconsommation ↑

### 6) Week-end (extension)
- Charges décalables (LL, LV, cuisson)
- Prévu pour tests ultérieurs

---

## Préparation S5 — multi-équipements

### 7) Hiver rigoureux — Chauffage prioritaire
- Ajouter un modèle de chauffage : consigne jour 20 °C / nuit 17 °C.
- PV faible (pic 2.2 kW), baseLoad 0.6→1.4 kW soir.
- Objectif : vérifier maintien confort + arbitrage ECS/chauffage.

### 8) Été piscine — Filtration 10h–16h
- Pompe 1.2 kW, durée cible 6 h (priorité PV mi-journée).
- PV élevé (pic 4.5 kW), baseLoad 0.4→0.7 kW.
- Objectif : garantir `h_min` même par météo moyenne.

### 9) Soirée VE — Recharge 18h–7h
- Session VE 22 kWh, P_max 7.4 kW, arrivée 18h, départ 7h.
- Vérifier interaction avec `reserve_evening` (réserve SOC vs charge VE).
- Valider `ev_departure_guard` (pas de déficit VE avant le départ, import réseau minimisé).

### 10) Stress multi-équipements — Hiver froid
- Chauffage modulable actif (consigne 20.5 °C jour / 18.5 °C nuit, puissance 6.8 kW).
- Pompe piscine 1.3 kW, objectif 6 h, fenêtres 10h–14h et 16h–18h.
- Session VE 20 kWh (18h → 7h) sur borne 7.2 kW.
- PV limité (pic 4.2 kW, atténuation 0.7) et baseLoad 0.55→1.45 kW.
- Objectif : éprouver `multi_equipment_priority`, observer les ratios confort chauffage/piscine/VE et arbitrer batterie en dernier recours.

Ces scénarios seront détaillés et testés au fil des sous-étapes décrites dans `Docs/s5_plan.md`.

---

## Format jeux de données
- `scenarios.ts` exporte des générateurs et/ou JSON
- Séries `pv[t]` et `load_base[t]` de longueur N = durée/dt
- Paramètres équipements embarqués ou modifiables via UI
